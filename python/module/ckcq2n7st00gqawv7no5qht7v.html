<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.2.0',
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>


  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})
  (window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/af1c402f.js","daovoice")
  daovoice('init', {
    app_id: "af1c402f"});
  daovoice('update');
  </script>

  <meta name="description" content="Source code: Lib/collections/init.py 这个模块实现了特定目标的容器，以提供Python标准内建容器 dict , list , set , 和 tuple 的替代选择。">
<meta name="keywords" content="python,module">
<meta property="og:type" content="article">
<meta property="og:title" content="python collections module">
<meta property="og:url" content="https://forgetst.github.io/python/module/ckcq2n7st00gqawv7no5qht7v.html">
<meta property="og:site_name" content="勿忘，须舍">
<meta property="og:description" content="Source code: Lib/collections/init.py 这个模块实现了特定目标的容器，以提供Python标准内建容器 dict , list , set , 和 tuple 的替代选择。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-02-21T16:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python collections module">
<meta name="twitter:description" content="Source code: Lib/collections/init.py 这个模块实现了特定目标的容器，以提供Python标准内建容器 dict , list , set , 和 tuple 的替代选择。">



  <link rel="alternate" href="/atom.xml" title="勿忘，须舍" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://forgetst.github.io/python/module/ckcq2n7st00gqawv7no5qht7v">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>python collections module | 勿忘，须舍</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/forgetST" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">勿忘，须舍</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-python">

    
    
      
    

    

    <a href="/categories/python/" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>python 随记</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://forgetst.github.io/python/module/ckcq2n7st00gqawv7no5qht7v.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr Wang">
      <meta itemprop="description" content="行动了才会有故事，说出来才会有结果。">
      <meta itemprop="image" content="/images/profile.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="勿忘，须舍">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">python collections module

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-02-22 00:00" itemprop="dateCreated datePublished" datetime="2020-02-22T00:00:00+08:00">2020-02-22</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/module/" itemprop="url" rel="index"><span itemprop="name">module</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>Source code:</strong> <a href="https://github.com/python/cpython/tree/3.8/Lib/collections/__init__.py" target="_blank" rel="noopener">Lib/collections/<strong>init</strong>.py</a></p>
<p>这个模块实现了特定目标的容器，以提供Python标准内建容器 <strong>dict</strong> , list , <strong>set</strong> , 和 <strong>tuple</strong> 的替代选择。</p>
<a id="more"></a>

<h2 id="方法概述"><a href="#方法概述" class="headerlink" title="方法概述"></a>方法概述</h2><table>
<thead>
<tr>
<th><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.namedtuple" target="_blank" rel="noopener"><code>namedtuple()</code></a></th>
<th>创建命名元组子类的工厂函数</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.deque" target="_blank" rel="noopener"><code>deque</code></a></td>
<td>类似列表(list)的容器，实现了在两端快速添加(append)和弹出(pop)</td>
</tr>
<tr>
<td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.ChainMap" target="_blank" rel="noopener"><code>ChainMap</code></a></td>
<td>类似字典(dict)的容器类，将多个映射集合到一个视图里面</td>
</tr>
<tr>
<td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.Counter" target="_blank" rel="noopener"><code>Counter</code></a></td>
<td>字典的子类，提供了可哈希对象的计数功能</td>
</tr>
<tr>
<td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.OrderedDict" target="_blank" rel="noopener"><code>OrderedDict</code></a></td>
<td>字典的子类，保存了他们被添加的顺序</td>
</tr>
<tr>
<td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.defaultdict" target="_blank" rel="noopener"><code>defaultdict</code></a></td>
<td>字典的子类，提供了一个工厂函数，为字典查询提供一个默认值</td>
</tr>
<tr>
<td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.UserDict" target="_blank" rel="noopener"><code>UserDict</code></a></td>
<td>封装了字典对象，简化了字典子类化</td>
</tr>
<tr>
<td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.UserList" target="_blank" rel="noopener"><code>UserList</code></a></td>
<td>封装了列表对象，简化了列表子类化</td>
</tr>
<tr>
<td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.UserString" target="_blank" rel="noopener"><code>UserString</code></a></td>
<td>封装了列表对象，简化了字符串子类化</td>
</tr>
</tbody></table>
<h2 id="ChainMap-对象"><a href="#ChainMap-对象" class="headerlink" title="ChainMap 对象"></a>ChainMap 对象</h2><h3 id="class-collections-ChainMap-maps"><a href="#class-collections-ChainMap-maps" class="headerlink" title="class collections.ChainMap(*maps)"></a>class collections.ChainMap(*maps)</h3><p>一个 ChainMap 将多个字典或者其他映射组合在一起，创建一个单独的可更新的视图。 如果没有 maps 被指定，就提供一个默认的空字典，这样一个新链至少有一个映射。</p>
<p>底层映射被存储在一个列表中。这个列表是公开的，可以通过 maps 属性存取和更新。没有其他的状态。</p>
<p>搜索查询底层映射，直到一个键被找到。不同的是，写，更新和删除只操作第一个映射。</p>
<p>一个 ChainMap 通过引用合并底层映射。 所以，如果一个底层映射更新了，这些更改会反映到 ChainMap 。</p>
<p>支持所有常用字典方法。另外还有一个 maps 属性(attribute)，一个创建子上下文的方法(method)， 一个存取它们首个映射的属性(property):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import ChainMap</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; baseline = &#123;&apos;music&apos;: &apos;bach&apos;, &apos;art&apos;: &apos;rembrandt&apos;&#125;</span><br><span class="line">&gt;&gt;&gt; adjustments = &#123;&apos;art&apos;: &apos;van gogh&apos;, &apos;opera&apos;: &apos;carmen&apos;&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; comb = ChainMap(baseline, adjustments)</span><br><span class="line">&gt;&gt;&gt; list(comb)</span><br><span class="line">[&apos;music&apos;, &apos;art&apos;, &apos;opera&apos;]</span><br></pre></td></tr></table></figure>

<h4 id="maps"><a href="#maps" class="headerlink" title="maps"></a>maps</h4><p>一个可以更新的映射列表。这个列表是按照第一次搜索到最后一次搜索的顺序组织的。它是仅有的存储状态，可以被修改。列表最少包含一个映射。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; comb.maps</span><br><span class="line">[&#123;&apos;music&apos;: &apos;bach&apos;, &apos;art&apos;: &apos;rembrandt&apos;&#125;, &#123;&apos;art&apos;: &apos;van gogh&apos;, &apos;opera&apos;: &apos;carmen&apos;&#125;]</span><br></pre></td></tr></table></figure>

<h4 id="new-child-m-None"><a href="#new-child-m-None" class="headerlink" title="new_child(m=None)"></a>new_child(m=None)</h4><p>返回一个新的 ChainMap 类，包含了一个新映射(map)，后面跟随当前实例的全部映射(map)。如果 m 被指定，它就成为不同新的实例，就是在所有映射前加上 m，如果没有指定，就加上一个空字典，这样的话一个 d.new_child() 调用等价于 ChainMap({}, *d.maps) 。这个方法用于创建子上下文，不改变任何父映射的值。</p>
<p>在 3.4 版更改: 添加了 m 可选参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; comb.new_child(&#123;&apos;sport&apos;: &apos;swim&apos;&#125;)</span><br><span class="line">ChainMap(&#123;&apos;sport&apos;: &apos;swim&apos;&#125;, &#123;&apos;music&apos;: &apos;bach&apos;, &apos;art&apos;: &apos;rembrandt&apos;&#125;, &#123;&apos;art&apos;: &apos;van gogh&apos;, &apos;opera&apos;: &apos;carmen&apos;&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="parents"><a href="#parents" class="headerlink" title="parents"></a>parents</h4><p>属性返回一个新的 ChainMap 包含所有的当前实例的映射，除了第一个。这样可以在搜索的时候跳过第一个映射。 使用的场景类似在 nested scopes 嵌套作用域中使用 nonlocal 关键词。用例也可以类比内建函数 super() 。一个 d.parents 的引用等价于 ChainMap(*d.maps[1:]) 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; comb.parents</span><br><span class="line">ChainMap(&#123;&apos;art&apos;: &apos;van gogh&apos;, &apos;opera&apos;: &apos;carmen&apos;&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="ChainMap-例子和方法"><a href="#ChainMap-例子和方法" class="headerlink" title="ChainMap 例子和方法"></a>ChainMap 例子和方法</h4><p><strong>模拟Python内部lookup链的例子</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import builtins</span><br><span class="line">pylookup = ChainMap(locals(), globals(), vars(builtins))</span><br></pre></td></tr></table></figure>

<p><strong>让用户指定的命令行参数优先于环境变量，优先于默认值的例子</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from collections import ChainMap</span><br><span class="line">import os</span><br><span class="line">import argparse</span><br><span class="line"></span><br><span class="line">defaults = &#123;&apos;color&apos;: &apos;red&apos;, &apos;user&apos;: &apos;guest&apos;&#125;</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(&apos;-u&apos;, &apos;--user&apos;)</span><br><span class="line">parser.add_argument(&apos;-c&apos;, &apos;--color&apos;)</span><br><span class="line">namespace = parser.parse_args()</span><br><span class="line">command_line_args = &#123;k: v for k, v in vars(namespace).items() if v is not None&#125;</span><br><span class="line"></span><br><span class="line">combined = ChainMap(command_line_args, os.environ, defaults)</span><br><span class="line">print(combined[&apos;color&apos;])</span><br><span class="line">print(combined[&apos;user&apos;])</span><br></pre></td></tr></table></figure>

<p><strong>ChainMap 类只更新链中的第一个映射，但lookup会搜索整个链。 然而，如果需要深度写和删除，也可以很容易的通过定义一个子类来实现它</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class DeepChainMap(ChainMap):</span><br><span class="line">    &apos;Variant of ChainMap that allows direct updates to inner scopes&apos;</span><br><span class="line"></span><br><span class="line">    def __setitem__(self, key, value):</span><br><span class="line">        for mapping in self.maps:</span><br><span class="line">            if key in mapping:</span><br><span class="line">                mapping[key] = value</span><br><span class="line">                return</span><br><span class="line">        self.maps[0][key] = value</span><br><span class="line"></span><br><span class="line">    def __delitem__(self, key):</span><br><span class="line">        for mapping in self.maps:</span><br><span class="line">            if key in mapping:</span><br><span class="line">                del mapping[key]</span><br><span class="line">                return</span><br><span class="line">        raise KeyError(key)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d = DeepChainMap(&#123;&apos;zebra&apos;: &apos;black&apos;&#125;, &#123;&apos;elephant&apos;: &apos;blue&apos;&#125;, &#123;&apos;lion&apos;: &apos;yellow&apos;&#125;)</span><br><span class="line">&gt;&gt;&gt; d[&apos;lion&apos;] = &apos;orange&apos;         # update an existing key two levels down</span><br><span class="line">&gt;&gt;&gt; d[&apos;snake&apos;] = &apos;red&apos;           # new keys get added to the topmost dict</span><br><span class="line">&gt;&gt;&gt; del d[&apos;elephant&apos;]            # remove an existing key one level down</span><br><span class="line">&gt;&gt;&gt; d                            # display result</span><br><span class="line">DeepChainMap(&#123;&apos;zebra&apos;: &apos;black&apos;, &apos;snake&apos;: &apos;red&apos;&#125;, &#123;&#125;, &#123;&apos;lion&apos;: &apos;orange&apos;&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Counter-对象"><a href="#Counter-对象" class="headerlink" title="Counter 对象"></a>Counter 对象</h2><p>一个计数器工具提供快速和方便的计数。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; # Tally occurrences of words in a list</span><br><span class="line">&gt;&gt;&gt; cnt = Counter()</span><br><span class="line">&gt;&gt;&gt; for word in [&apos;red&apos;, &apos;blue&apos;, &apos;red&apos;, &apos;green&apos;, &apos;blue&apos;, &apos;blue&apos;]:</span><br><span class="line">...     cnt[word] += 1</span><br><span class="line">&gt;&gt;&gt; cnt</span><br><span class="line">Counter(&#123;&apos;blue&apos;: 3, &apos;red&apos;: 2, &apos;green&apos;: 1&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; # Find the ten most common words in Hamlet</span><br><span class="line">&gt;&gt;&gt; import re</span><br><span class="line">&gt;&gt;&gt; words = re.findall(r&apos;\w+&apos;, open(&apos;hamlet.txt&apos;).read().lower())</span><br><span class="line">&gt;&gt;&gt; Counter(words).most_common(10)</span><br><span class="line">[(&apos;the&apos;, 1143), (&apos;and&apos;, 966), (&apos;to&apos;, 762), (&apos;of&apos;, 669), (&apos;i&apos;, 631),</span><br><span class="line"> (&apos;you&apos;, 554),  (&apos;a&apos;, 546), (&apos;my&apos;, 514), (&apos;hamlet&apos;, 471), (&apos;in&apos;, 451)]</span><br></pre></td></tr></table></figure>

<h3 id="class-collections-Counter-iterable-or-mapping"><a href="#class-collections-Counter-iterable-or-mapping" class="headerlink" title="class collections.Counter([iterable-or-mapping])"></a>class collections.Counter([iterable-or-mapping])</h3><p>一个 Counter 是一个 dict 的子类，用于计数可哈希对象。它是一个集合，元素像字典键(key)一样存储，它们的计数存储为值。计数可以是任何整数值，包括0和负数。 Counter 类有点像其他语言中的 bags或multisets。</p>
<p>元素从一个 <em>iterable</em> 被计数或从其他的 <em>mapping</em> (or counter)初始化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = Counter()                           # a new, empty counter</span><br><span class="line">&gt;&gt;&gt; c = Counter(&apos;gallahad&apos;)                 # a new counter from an iterable</span><br><span class="line">&gt;&gt;&gt; c = Counter(&#123;&apos;red&apos;: 4, &apos;blue&apos;: 2&#125;)      # a new counter from a mapping</span><br><span class="line">&gt;&gt;&gt; c = Counter(cats=4, dogs=8)             # a new counter from keyword args</span><br></pre></td></tr></table></figure>

<p>Counter对象有一个字典接口，如果引用的键没有任何记录，就返回一个0，而不是弹出一个 <a href="https://docs.python.org/zh-cn/3/library/exceptions.html#KeyError" target="_blank" rel="noopener"><code>KeyError</code></a> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = Counter([&apos;eggs&apos;, &apos;ham&apos;])</span><br><span class="line">&gt;&gt;&gt; c[&apos;bacon&apos;]                              # count of a missing element is zero</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>设置一个计数为0不会从计数器中移去一个元素。使用 <code>del</code> 来删除它:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c[&apos;sausage&apos;] = 0                        # counter entry with a zero count</span><br><span class="line">&gt;&gt;&gt; del c[&apos;sausage&apos;]                        # del actually removes the entry</span><br></pre></td></tr></table></figure>

<p>在 3.7 版更改: 作为 dict 的子类，Counter 继承了记住插入顺序的功能。 Counter 对象进行数学运算时同样会保持顺序。 结果会先按每个元素在运算符左边的出现时间排序，然后再按其在运算符右边的出现时间排序。</p>
<p>计数器对象除了字典方法以外，还提供了三个其他的方法：</p>
<h4 id="elements"><a href="#elements" class="headerlink" title="elements()"></a>elements()</h4><p>返回一个迭代器，其中每个元素将重复出现计数值所指定次。 元素会按首次出现的顺序返回。 如果一个元素的计数值小于一，<a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.Counter.elements" target="_blank" rel="noopener"><code>elements()</code></a> 将会忽略它。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = Counter(a=4, b=2, c=0, d=-2)</span><br><span class="line">&gt;&gt;&gt; sorted(c.elements())</span><br><span class="line">[&apos;a&apos;, &apos;a&apos;, &apos;a&apos;, &apos;a&apos;, &apos;b&apos;, &apos;b&apos;]</span><br></pre></td></tr></table></figure>

<h4 id="most-common-n"><a href="#most-common-n" class="headerlink" title="most_common([n])"></a>most_common([n])</h4><p>返回一个列表，其中包含 n 个最常见的元素及出现次数，按常见程度由高到低排序。 如果 n 被省略或为 None，most_common() 将返回计数器中的 所有 元素。 计数值相等的元素按首次出现的顺序排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Counter(&apos;abracadabra&apos;).most_common(3)</span><br><span class="line">[(&apos;a&apos;, 5), (&apos;b&apos;, 2), (&apos;r&apos;, 2)]</span><br></pre></td></tr></table></figure>

<p>通常字典方法都可用于 Counter 对象，除了有两个方法工作方式与字典并不相同。</p>
<h4 id="fromkeys-iterable"><a href="#fromkeys-iterable" class="headerlink" title="fromkeys(iterable)"></a>fromkeys(iterable)</h4><p>这个类方法没有在 Counter 中实现。</p>
<h4 id="update-iterable-or-mapping"><a href="#update-iterable-or-mapping" class="headerlink" title="update([iterable-or-mapping])"></a>update([iterable-or-mapping])</h4><p>从 迭代对象 计数元素或者 从另一个 映射对象 (或计数器) 添加。 像 dict.update() 但是是加上，而不是替换。另外，迭代对象 应该是序列元素，而不是一个 (key, value) 对。</p>
<h3 id="Counter对象的常用案例"><a href="#Counter对象的常用案例" class="headerlink" title="Counter对象的常用案例"></a>Counter对象的常用案例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sum(c.values())                 # total of all counts</span><br><span class="line">c.clear()                       # reset all counts</span><br><span class="line">list(c)                         # list unique elements</span><br><span class="line">set(c)                          # convert to a set</span><br><span class="line">dict(c)                         # convert to a regular dictionary</span><br><span class="line">c.items()                       # convert to a list of (elem, cnt) pairs</span><br><span class="line">Counter(dict(list_of_pairs))    # convert from a list of (elem, cnt) pairs</span><br><span class="line">c.most_common()[:-n-1:-1]       # n least common elements</span><br><span class="line">+c                              # remove zero and negative counts</span><br></pre></td></tr></table></figure>

<p>提供了几个数学操作，可以结合 <a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.Counter" target="_blank" rel="noopener"><code>Counter</code></a> 对象，以生产 multisets (计数器中大于0的元素）。 加和减，结合计数器，通过加上或者减去元素的相应计数。交集和并集返回相应计数的最小或最大值。每种操作都可以接受带符号的计数，但是输出会忽略掉结果为零或者小于零的计数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = Counter(a=3, b=1)</span><br><span class="line">&gt;&gt;&gt; d = Counter(a=1, b=2)</span><br><span class="line">&gt;&gt;&gt; c + d                       # add two counters together:  c[x] + d[x]</span><br><span class="line">Counter(&#123;&apos;a&apos;: 4, &apos;b&apos;: 3&#125;)</span><br><span class="line">&gt;&gt;&gt; c - d                       # subtract (keeping only positive counts)</span><br><span class="line">Counter(&#123;&apos;a&apos;: 2&#125;)</span><br><span class="line">&gt;&gt;&gt; c &amp; d                       # intersection:  min(c[x], d[x]) </span><br><span class="line">Counter(&#123;&apos;a&apos;: 1, &apos;b&apos;: 1&#125;)</span><br><span class="line">&gt;&gt;&gt; c | d                       # union:  max(c[x], d[x])</span><br><span class="line">Counter(&#123;&apos;a&apos;: 3, &apos;b&apos;: 2&#125;)</span><br></pre></td></tr></table></figure>

<p>单目加和减（一元操作符）意思是从空计数器加或者减去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = Counter(a=2, b=-4)</span><br><span class="line">&gt;&gt;&gt; +c</span><br><span class="line">Counter(&#123;&apos;a&apos;: 2&#125;)</span><br><span class="line">&gt;&gt;&gt; -c</span><br><span class="line">Counter(&#123;&apos;b&apos;: 4&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="deque-对象"><a href="#deque-对象" class="headerlink" title="deque 对象"></a>deque 对象</h2><h3 id="class-collections-deque-iterable-maxlen"><a href="#class-collections-deque-iterable-maxlen" class="headerlink" title="class collections.deque([iterable[, maxlen]])"></a>class collections.deque([iterable[, maxlen]])</h3><p>返回一个新的双向队列对象，从左到右初始化(用方法 append()) ，从 iterable （迭代对象) 数据创建。如果 iterable 没有指定，新队列为空。</p>
<p>Deque队列是由栈或者queue队列生成的（发音是 “deck”，”double-ended queue”的简称）。Deque 支持线程安全，内存高效添加(append)和弹出(pop)，从两端都可以，两个方向的大概开销都是 O(1) 复杂度。</p>
<p>虽然 list 对象也支持类似操作，不过这里优化了定长操作和 pop(0) 和 insert(0, v) 的开销。它们引起 O(n) 内存移动的操作，改变底层数据表达的大小和位置。</p>
<p>如果 maxlen 没有指定或者是 None ，deques 可以增长到任意长度。否则，deque就限定到指定最大长度。一旦限定长度的deque满了，当新项加入时，同样数量的项就从另一端弹出。限定长度deque提供类似Unix filter tail 的功能。它们同样可以用与追踪最近的交换和其他数据池活动。</p>
<p>双向队列(deque)对象支持以下方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)                 # make a new deque with three items</span><br><span class="line">&gt;&gt;&gt; for elem in d:                   # iterate over the deque&apos;s elements</span><br><span class="line">...     print(elem.upper())</span><br><span class="line">G</span><br><span class="line">H</span><br><span class="line">I</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; list(d)                          # list the contents of the deque</span><br><span class="line">[&apos;g&apos;, &apos;h&apos;, &apos;i&apos;]</span><br><span class="line">&gt;&gt;&gt; d[0]                             # peek at leftmost item</span><br><span class="line">&apos;g&apos;</span><br><span class="line">&gt;&gt;&gt; d[-1]                            # peek at rightmost item</span><br><span class="line">&apos;i&apos;</span><br></pre></td></tr></table></figure>

<h4 id="append-x"><a href="#append-x" class="headerlink" title="append(x)"></a>append(x)</h4><p>添加 x 到右端。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = deque(<span class="string">'ghi'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.append(<span class="string">'j'</span>)                    <span class="comment"># add a new entry to the right side</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">deque([<span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>])</span><br></pre></td></tr></table></figure>

<h4 id="appendleft-x"><a href="#appendleft-x" class="headerlink" title="appendleft(x)"></a>appendleft(x)</h4><p>添加 x 到左端。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.appendleft(&apos;f&apos;)                # add a new entry to the left side</span><br><span class="line">&gt;&gt;&gt; d                                # show the representation of the deque</span><br><span class="line">deque([&apos;f&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;])</span><br></pre></td></tr></table></figure>

<h4 id="clear"><a href="#clear" class="headerlink" title="clear()"></a>clear()</h4><p>移除所有元素，使其长度为0.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.clear()</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">deque([])</span><br></pre></td></tr></table></figure>

<h4 id="copy"><a href="#copy" class="headerlink" title="copy()"></a>copy()</h4><p>创建一份浅拷贝。</p>
<p>3.5 新版功能.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.copy()</span><br><span class="line">deque(&apos;g&apos;, &apos;h&apos;, &apos;i&apos;)</span><br></pre></td></tr></table></figure>

<h4 id="count-x"><a href="#count-x" class="headerlink" title="count(x)"></a>count(x)</h4><p>计算deque中个数等于 x 的元素。</p>
<p>3.2 新版功能.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.count(&apos;h&apos;)</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h4 id="extend-iterable"><a href="#extend-iterable" class="headerlink" title="extend(iterable)"></a>extend(iterable)</h4><p>扩展deque的右侧，通过添加iterable参数中的元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.extend(&apos;lmn&apos;)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">deque([&apos;g&apos;, &apos;h&apos;, &apos;i&apos;, &apos;l&apos;, &apos;m&apos;, &apos;n&apos;])</span><br></pre></td></tr></table></figure>

<h4 id="extendleft-iterable"><a href="#extendleft-iterable" class="headerlink" title="extendleft(iterable)"></a>extendleft(iterable)</h4><p>扩展deque的左侧，通过添加iterable参数中的元素。注意，左添加时，在结果中iterable参数中的顺序将被反过来添加。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.extendleft(&apos;def&apos;)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">deque([&apos;f&apos;, &apos;e&apos;, &apos;d&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;])</span><br></pre></td></tr></table></figure>

<h4 id="index-x-start-stop"><a href="#index-x-start-stop" class="headerlink" title="index(x[, start[, stop]])"></a>index(x[, start[, stop]])</h4><p>返回第 x 个元素（从 start 开始计算，在 stop 之前）。返回第一个匹配，如果没找到的话，升起 ValueError 。</p>
<p>3.5 新版功能.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.index(&apos;h&apos;)</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d.index(&apos;x&apos;)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;pyshell#111&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">    d.index(&apos;x&apos;)</span><br><span class="line">ValueError: &apos;x&apos; is not in deque</span><br></pre></td></tr></table></figure>

<h4 id="insert-i-x"><a href="#insert-i-x" class="headerlink" title="insert(i, x)"></a>insert(i, x)</h4><p>在位置 i 插入 x 。</p>
<p>如果插入会导致一个限长deque超出长度 maxlen 的话，就升起一个 IndexError 。</p>
<p>3.5 新版功能.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.insert(0, &apos;f&apos;)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">deque([&apos;f&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;])</span><br></pre></td></tr></table></figure>

<h4 id="pop"><a href="#pop" class="headerlink" title="pop()"></a>pop()</h4><p>移去并且返回一个元素，deque最右侧的那一个。如果没有元素的话，就升起 IndexError 索引错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.pop()                          # return and remove the rightmost item</span><br><span class="line">&apos;i&apos;</span><br></pre></td></tr></table></figure>

<h4 id="popleft"><a href="#popleft" class="headerlink" title="popleft()"></a>popleft()</h4><p>移去并且返回一个元素，deque最左侧的那一个。如果没有元素的话，就升起 IndexError 索引错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.popleft()                      # return and remove the leftmost item</span><br><span class="line">&apos;g&apos;</span><br></pre></td></tr></table></figure>

<h4 id="remove-value"><a href="#remove-value" class="headerlink" title="remove(value)"></a>remove(value)</h4><p>移去找到的第一个 value。 如果没有的话就升起 ValueError 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.remove(&apos;h&apos;)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">deque(&apos;g&apos;, &apos;i&apos;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d.remove(&apos;h&apos;)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;pyshell#119&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">    d.remove(&apos;h&apos;)</span><br><span class="line">ValueError: deque.remove(x): x not in deque</span><br></pre></td></tr></table></figure>

<h4 id="reverse"><a href="#reverse" class="headerlink" title="reverse()"></a>reverse()</h4><p>将deque逆序排列。返回 None 。</p>
<p>3.2 新版功能.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.reverse()</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">deque([&apos;i&apos;, &apos;h&apos;, &apos;g&apos;])</span><br></pre></td></tr></table></figure>

<h4 id="rotate-n-1"><a href="#rotate-n-1" class="headerlink" title="rotate(n=1)"></a>rotate(n=1)</h4><p>向右循环移动 n 步。 如果 n 是负数，就向左循环。</p>
<p>如果deque不是空的，向右循环移动一步就等价于 d.appendleft(d.pop()) ， 向左循环一步就等价于 d.append(d.popleft()) 。</p>
<p>Deque对象同样提供了一个只读属性:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.rotate(1)                      # right rotation</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">deque([&apos;i&apos;, &apos;g&apos;, &apos;h&apos;])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d = deque(&apos;ghi&apos;)</span><br><span class="line">&gt;&gt;&gt; d.rotate(-1)                     # left rotation</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">deque([&apos;h&apos;, &apos;i&apos;, &apos;g&apos;])</span><br></pre></td></tr></table></figure>

<h4 id="maxlen"><a href="#maxlen" class="headerlink" title="maxlen"></a>maxlen</h4><p>Deque的最大尺寸，如果没有限定的话就是 None 。</p>
<p>3.1 新版功能.</p>
<p>除了以上操作，deque 还支持迭代、封存、len(d)、reversed(d)、copy.copy(d)、copy.deepcopy(d)、成员检测运算符 in 以及下标引用例如通过 d[0] 访问首个元素等。 索引访问在两端的复杂度均为 O(1) 但在中间则会低至 O(n)。 如需快速随机访问，请改用列表。</p>
<p>Deque从版本3.5开始支持 __add__(),__mul__(), 和 __imul__() 。</p>
<h3 id="deque-用法"><a href="#deque-用法" class="headerlink" title="deque 用法"></a>deque 用法</h3><p><strong>限长deque提供了类似Unix <code>tail</code> 过滤功能</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def tail(filename, n=10):</span><br><span class="line">    &apos;Return the last n lines of a file&apos;</span><br><span class="line">    with open(filename) as f:</span><br><span class="line">        return deque(f, n)</span><br></pre></td></tr></table></figure>

<p><strong>维护一个近期添加元素的序列，通过从右边添加和从左边弹出</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def moving_average(iterable, n=3):</span><br><span class="line">    # moving_average([40, 30, 50, 46, 39, 44]) --&gt; 40.0 42.0 45.0 43.0</span><br><span class="line">    # http://en.wikipedia.org/wiki/Moving_average</span><br><span class="line">    it = iter(iterable)</span><br><span class="line">    d = deque(itertools.islice(it, n-1))</span><br><span class="line">    d.appendleft(0)</span><br><span class="line">    s = sum(d)</span><br><span class="line">    for elem in it:</span><br><span class="line">        s += elem - d.popleft()</span><br><span class="line">        d.append(elem)</span><br><span class="line">        yield s / n</span><br></pre></td></tr></table></figure>

<h2 id="defaultdict-对象"><a href="#defaultdict-对象" class="headerlink" title="defaultdict 对象"></a>defaultdict 对象</h2><h3 id="class-collections-defaultdict-default-factory-…"><a href="#class-collections-defaultdict-default-factory-…" class="headerlink" title="class collections.defaultdict([default_factory[, …]])"></a>class collections.defaultdict([default_factory[, …]])</h3><p>返回一个新的类似字典的对象。 defaultdict 是内置 dict 类的子类。它重载了一个方法并添加了一个可写的实例变量。其余的功能与 dict 类相同，此处不再重复说明。</p>
<p>本对象包含一个名为 default_factory 的属性，构造时，第一个参数用于为该属性提供初始值，默认为 None。所有其他参数（包括关键字参数）都相当于传递给 dict 的构造函数。</p>
<p>defaultdict 对象除了支持标准 dict 的操作，还支持以下方法作为扩展：</p>
<h4 id="missing-key"><a href="#missing-key" class="headerlink" title="missing(key)"></a><strong>missing</strong>(key)</h4><p>如果 default_factory 属性为 None，则调用本方法会抛出 KeyError 异常，附带参数 key。</p>
<p>如果 default_factory 不为 None，则它会被（不带参数地）调用来为 key 提供一个默认值，这个值和 key 作为一对键值对被插入到字典中，并作为本方法的返回值返回。</p>
<p>如果调用 default_factory 时抛出了异常，这个异常会原封不动地向外层传递。</p>
<p>在无法找到所需键值时，本方法会被 dict 中的 <strong>getitem</strong>() 方法调用。无论本方法返回了值还是抛出了异常，都会被 <strong>getitem</strong>() 传递。</p>
<p>注意，<strong>missing</strong>() 不会 被 <strong>getitem</strong>() 以外的其他方法调用。意味着 get() 会像正常的 dict 那样返回 None，而不是使用 default_factory。</p>
<p>defaultdict 对象支持以下实例变量：</p>
<h4 id="default-factory"><a href="#default-factory" class="headerlink" title="default_factory"></a>default_factory</h4><p>本属性由 <strong>missing</strong>() 方法来调用。如果构造对象时提供了第一个参数，则本属性会被初始化成那个参数，如果未提供第一个参数，则本属性为 None。</p>
<h3 id="defaultdict-例子"><a href="#defaultdict-例子" class="headerlink" title="defaultdict 例子"></a>defaultdict 例子</h3><p>使用 list 作为 default_factory，很轻松地将（键-值对组成的）序列转换为（键-列表组成的）字典：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = [(&apos;yellow&apos;, 1), (&apos;blue&apos;, 2), (&apos;yellow&apos;, 3), (&apos;blue&apos;, 4), (&apos;red&apos;, 1)]</span><br><span class="line">&gt;&gt;&gt; d = defaultdict(list)</span><br><span class="line">&gt;&gt;&gt; for k, v in s:</span><br><span class="line">...     d[k].append(v)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; sorted(d.items())</span><br><span class="line">[(&apos;blue&apos;, [2, 4]), (&apos;red&apos;, [1]), (&apos;yellow&apos;, [1, 3])]</span><br></pre></td></tr></table></figure>

<p>等价于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; for k, v in s:</span><br><span class="line">...     d.setdefault(k, []).append(v)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; sorted(d.items())</span><br><span class="line">[(&apos;blue&apos;, [2, 4]), (&apos;red&apos;, [1]), (&apos;yellow&apos;, [1, 3])]</span><br></pre></td></tr></table></figure>

<p>函数 <a href="https://docs.python.org/zh-cn/3/library/functions.html#int" target="_blank" rel="noopener"><code>int()</code></a> 总是返回 0，这是常数函数的特殊情况。一个更快和灵活的方法是使用 lambda 函数，可以提供任何常量值（不只是0）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def constant_factory(value):</span><br><span class="line">...     return lambda: value</span><br><span class="line">&gt;&gt;&gt; d = defaultdict(constant_factory(&apos;&lt;missing&gt;&apos;))</span><br><span class="line">&gt;&gt;&gt; d.update(name=&apos;John&apos;, action=&apos;ran&apos;)</span><br><span class="line">&gt;&gt;&gt; &apos;%(name)s %(action)s to %(object)s&apos; % d</span><br><span class="line">&apos;John ran to &lt;missing&gt;&apos;</span><br></pre></td></tr></table></figure>

<p>设置 <a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.defaultdict.default_factory" target="_blank" rel="noopener"><code>default_factory</code></a> 为 <a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#set" target="_blank" rel="noopener"><code>set</code></a> 使 <a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.defaultdict" target="_blank" rel="noopener"><code>defaultdict</code></a> 用于构建 set 集合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = [(&apos;red&apos;, 1), (&apos;blue&apos;, 2), (&apos;red&apos;, 3), (&apos;blue&apos;, 4), (&apos;red&apos;, 1), (&apos;blue&apos;, 4)]</span><br><span class="line">&gt;&gt;&gt; d = defaultdict(set)</span><br><span class="line">&gt;&gt;&gt; for k, v in s:</span><br><span class="line">...     d[k].add(v)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; sorted(d.items())</span><br><span class="line">[(&apos;blue&apos;, &#123;2, 4&#125;), (&apos;red&apos;, &#123;1, 3&#125;)]</span><br></pre></td></tr></table></figure>

<h2 id="namedtuple-命名元组的工厂函数"><a href="#namedtuple-命名元组的工厂函数" class="headerlink" title="namedtuple() 命名元组的工厂函数"></a>namedtuple() 命名元组的工厂函数</h2><h3 id="collections-namedtuple-typename-field-names-rename-False-defaults-None-module-None"><a href="#collections-namedtuple-typename-field-names-rename-False-defaults-None-module-None" class="headerlink" title="collections.namedtuple(typename, field_names, *, rename=False, defaults=None, module=None)"></a>collections.namedtuple(typename, field_names, *, rename=False, defaults=None, module=None)</h3><p>返回一个新的元组子类，名为 typename 。这个新的子类用于创建类元组的对象，可以通过域名来获取属性值，同样也可以通过索引和迭代获取值。子类实例同样有文档字符串（类名和域名）另外一个有用的 <strong>repr</strong>() 方法，以 name=value 格式列明了元组内容。</p>
<p><strong>field_names</strong> 是一个像 [‘x’, ‘y’] 一样的字符串序列。另外 field_names 可以是一个纯字符串，用空白或逗号分隔开元素名，比如 ‘x y’ 或者 ‘x, y’ 。</p>
<p>任何有效的Python 标识符都可以作为域名，除了下划线开头的那些。有效标识符由字母，数字，下划线组成，但首字母不能是数字或下划线，另外不能是关键词 keyword 比如 class, for, return, global, pass, 或 raise 。</p>
<p> <strong>rename</strong> 如果为真， 无效域名会自动转换成位置名。比如 [‘abc’, ‘def’, ‘ghi’, ‘abc’] 转换成 [‘abc’, ‘_1’, ‘ghi’, ‘_3’] ， 消除关键词 def 和重复域名 abc 。</p>
<p><strong>defaults</strong> 可以为 None 或者是一个默认值的 iterable 。如果一个默认值域必须跟其他没有默认值的域在一起出现，defaults 就应用到最右边的参数。比如如果域名 [‘x’, ‘y’, ‘z’] 和默认值 (1, 2) ，那么 x 就必须指定一个参数值 ，y 默认值 1 ， z 默认值 2 。</p>
<p>如果 module 值有定义，命名元组的 <strong>module</strong> 属性值就被设置。</p>
<p>命名元组实例没有字典，所以它们要更轻量，并且占用更小内存。</p>
<p>除了继承元组的方法，命名元组还支持三个额外的方法和两个属性。为了防止域名冲突，方法和属性以下划线开始。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Basic example</span><br><span class="line">&gt;&gt;&gt; from collections import namedtuple</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; Point = namedtuple(&apos;Point&apos;, [&apos;x&apos;, &apos;y&apos;])</span><br><span class="line">&gt;&gt;&gt; p = Point(11, y=22)     # instantiate with positional or keyword arguments</span><br><span class="line">&gt;&gt;&gt; p[0] + p[1]             # indexable like the plain tuple (11, 22)</span><br><span class="line">33</span><br><span class="line">&gt;&gt;&gt; x, y = p                # unpack like a regular tuple</span><br><span class="line">&gt;&gt;&gt; x, y</span><br><span class="line">(11, 22)</span><br><span class="line">&gt;&gt;&gt; p.x + p.y               # fields also accessible by name</span><br><span class="line">33</span><br><span class="line">&gt;&gt;&gt; p                       # readable __repr__ with a name=value style</span><br><span class="line">Point(x=11, y=22)</span><br></pre></td></tr></table></figure>

<h4 id="classmethod-somenamedtuple-make-iterable"><a href="#classmethod-somenamedtuple-make-iterable" class="headerlink" title="classmethod somenamedtuple._make(iterable)"></a>classmethod somenamedtuple._make(iterable)</h4><p>类方法从存在的序列或迭代实例创建一个新实例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; t = [11, 22]</span><br><span class="line">&gt;&gt;&gt; Point._make(t)</span><br><span class="line">Point(x=11, y=22)</span><br></pre></td></tr></table></figure>

<h4 id="somenamedtuple-asdict"><a href="#somenamedtuple-asdict" class="headerlink" title="somenamedtuple._asdict()"></a>somenamedtuple._asdict()</h4><p>返回一个新的 dict ，它将字段名称映射到它们对应的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; p = Point(x=11, y=22)</span><br><span class="line">&gt;&gt;&gt; p._asdict()</span><br><span class="line">&#123;&apos;x&apos;: 11, &apos;y&apos;: 22&#125;</span><br></pre></td></tr></table></figure>

<p>在 3.1 版更改: 返回一个 OrderedDict 而不是 dict 。</p>
<p>在 3.8 版更改: 返回一个常规 dict 而不是 OrderedDict。 因为自 Python 3.7 起，常规字典已经保证有序。 如果需要 OrderedDict 的额外特性，推荐的解决方案是将结果转换为需要的类型: OrderedDict(nt._asdict())。</p>
<h4 id="somenamedtuple-replace-kwargs"><a href="#somenamedtuple-replace-kwargs" class="headerlink" title="somenamedtuple._replace(**kwargs)"></a>somenamedtuple._replace(**kwargs)</h4><p>返回一个新的命名元组实例，并将指定域替换为新的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; p = Point(x=11, y=22)</span><br><span class="line">&gt;&gt;&gt; p._replace(x=33)</span><br><span class="line">Point(x=33, y=22)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; for partnum, record in inventory.items():</span><br><span class="line">        inventory[partnum] = record._replace(price=newprices[partnum], timestamp=time.now())</span><br></pre></td></tr></table></figure>

<h4 id="somenamedtuple-fields"><a href="#somenamedtuple-fields" class="headerlink" title="somenamedtuple._fields"></a>somenamedtuple._fields</h4><p>字符串元组列出了域名。用于提醒和从现有元组创建一个新的命名元组类型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; p._fields            # view the field names</span><br><span class="line">(&apos;x&apos;, &apos;y&apos;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; Color = namedtuple(&apos;Color&apos;, &apos;red green blue&apos;)</span><br><span class="line">&gt;&gt;&gt; Pixel = namedtuple(&apos;Pixel&apos;, Point._fields + Color._fields)</span><br><span class="line">&gt;&gt;&gt; Pixel(11, 22, 128, 255, 0)</span><br><span class="line">Pixel(x=11, y=22, red=128, green=255, blue=0)</span><br></pre></td></tr></table></figure>

<h4 id="somenamedtuple-field-defaults"><a href="#somenamedtuple-field-defaults" class="headerlink" title="somenamedtuple._field_defaults"></a>somenamedtuple._field_defaults</h4><p>默认值的字典。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Account = namedtuple(&apos;Account&apos;, [&apos;type&apos;, &apos;balance&apos;], defaults=[0])</span><br><span class="line">&gt;&gt;&gt; Account._field_defaults</span><br><span class="line">&#123;&apos;balance&apos;: 0&#125;</span><br><span class="line">&gt;&gt;&gt; Account(&apos;premium&apos;)</span><br><span class="line">Account(type=&apos;premium&apos;, balance=0)</span><br></pre></td></tr></table></figure>

<h2 id="OrderedDict-对象"><a href="#OrderedDict-对象" class="headerlink" title="OrderedDict 对象"></a>OrderedDict 对象</h2><ul>
<li>常规的 <a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict" target="_blank" rel="noopener"><code>dict</code></a> 被设计为非常擅长映射操作。 跟踪插入顺序是次要的。</li>
<li><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.OrderedDict" target="_blank" rel="noopener"><code>OrderedDict</code></a> 旨在擅长重新排序操作。 空间效率、迭代速度和更新操作的性能是次要的。</li>
<li>算法上， <a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.OrderedDict" target="_blank" rel="noopener"><code>OrderedDict</code></a> 可以比 <a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict" target="_blank" rel="noopener"><code>dict</code></a> 更好地处理频繁的重新排序操作。 这使其适用于跟踪最近的访问（例如在 <a href="https://medium.com/@krishankantsinghal/my-first-blog-on-medium-583159139237" target="_blank" rel="noopener">LRU cache</a> 中）。</li>
<li>对于 <a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.OrderedDict" target="_blank" rel="noopener"><code>OrderedDict</code></a> ，相等操作检查匹配顺序。</li>
<li><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.OrderedDict" target="_blank" rel="noopener"><code>OrderedDict</code></a> 类的 <code>popitem()</code> 方法有不同的签名。它接受一个可选参数来指定弹出哪个元素。</li>
<li><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.OrderedDict" target="_blank" rel="noopener"><code>OrderedDict</code></a> 类有一个 <code>move_to_end()</code> 方法，可以有效地将元素移动到任一端。</li>
<li>有序字典还另外提供了逆序迭代的支持，通过 <a href="https://docs.python.org/zh-cn/3/library/functions.html#reversed" target="_blank" rel="noopener"><code>reversed()</code></a> 。</li>
<li>Python 3.8之前， <a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict" target="_blank" rel="noopener"><code>dict</code></a> 缺少 <a href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__reversed__" target="_blank" rel="noopener"><code>__reversed__()</code></a> 方法。</li>
</ul>
<h3 id="class-collections-OrderedDict-items"><a href="#class-collections-OrderedDict-items" class="headerlink" title="class collections.OrderedDict([items])"></a>class collections.OrderedDict([items])</h3><h4 id="popitem-last-True"><a href="#popitem-last-True" class="headerlink" title="popitem(last=True)"></a>popitem(last=True)</h4><p>返回一个 dict 子类的实例，它具有专门用于重新排列字典顺序的方法。</p>
<p>有序字典的 popitem() 方法移除并返回一个 (key, value) 键值对。 如果 last 值为真，则按 LIFO 后进先出的顺序返回键值对，否则就按 FIFO 先进先出的顺序返回键值对。</p>
<h4 id="move-to-end-key-last-True"><a href="#move-to-end-key-last-True" class="headerlink" title="move_to_end(key, last=True)"></a>move_to_end(key, last=True)</h4><p>将现有 key 移动到有序字典的任一端。 如果 last 为真值（默认）则将元素移至末尾；如果 last 为假值则将元素移至开头。如果 key 不存在则会触发 KeyError:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = OrderedDict.fromkeys(&apos;abcde&apos;)</span><br><span class="line">&gt;&gt;&gt; d.move_to_end(&apos;b&apos;)</span><br><span class="line">&gt;&gt;&gt; &apos;&apos;.join(d.keys())</span><br><span class="line">&apos;acdeb&apos;</span><br><span class="line">&gt;&gt;&gt; d.move_to_end(&apos;b&apos;, last=False)</span><br><span class="line">&gt;&gt;&gt; &apos;&apos;.join(d.keys())</span><br><span class="line">&apos;bacde&apos;</span><br></pre></td></tr></table></figure>

<h3 id="OrderedDict-例子和用法"><a href="#OrderedDict-例子和用法" class="headerlink" title="OrderedDict 例子和用法"></a>OrderedDict 例子和用法</h3><p>创建记住键值 <em>最后</em> 插入顺序的有序字典变体很简单。 如果新条目覆盖现有条目，则原始插入位置将更改并移至末尾:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class LastUpdatedOrderedDict(OrderedDict):</span><br><span class="line">    &apos;Store items in the order the keys were last added&apos;</span><br><span class="line"></span><br><span class="line">    def __setitem__(self, key, value):</span><br><span class="line">        super().__setitem__(key, value)</span><br><span class="line">        self.move_to_end(key)</span><br></pre></td></tr></table></figure>

<p>一个 <a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.OrderedDict" target="_blank" rel="noopener"><code>OrderedDict</code></a> 对于实现 <a href="https://docs.python.org/zh-cn/3/library/functools.html#functools.lru_cache" target="_blank" rel="noopener"><code>functools.lru_cache()</code></a> 的变体也很有用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class LRU(OrderedDict):</span><br><span class="line">    &apos;Limit size, evicting the least recently looked-up key when full&apos;</span><br><span class="line"></span><br><span class="line">    def __init__(self, maxsize=128, /, *args, **kwds):</span><br><span class="line">        self.maxsize = maxsize</span><br><span class="line">        super().__init__(*args, **kwds)</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, key):</span><br><span class="line">        value = super().__getitem__(key)</span><br><span class="line">        self.move_to_end(key)</span><br><span class="line">        return value</span><br><span class="line"></span><br><span class="line">    def __setitem__(self, key, value):</span><br><span class="line">        super().__setitem__(key, value)</span><br><span class="line">        if len(self) &gt; self.maxsize:</span><br><span class="line">            oldest = next(iter(self))</span><br><span class="line">            del self[oldest]</span><br></pre></td></tr></table></figure>

<h2 id="UserDict-对象"><a href="#UserDict-对象" class="headerlink" title="UserDict 对象"></a>UserDict 对象</h2><p>UserDict 类是用作字典对象的外包装。对这个类的需求已部分由直接创建 dict 的子类的功能所替代；不过，这个类处理起来更容易，因为底层的字典可以作为属性来访问。</p>
<p>class collections.UserDict([initialdata])<br>模拟一个字典类。这个实例的内容保存为一个正常字典， 可以通过 UserDict 实例的 data 属性存取。如果提供了 initialdata 值， data 就被初始化为它的内容；注意一个 initialdata 的引用不会被保留作为其他用途。</p>
<p>UserDict 实例提供了以下属性作为扩展方法和操作的支持:</p>
<p>data<br>一个真实的字典，用于保存 UserDict 类的内容。</p>
<h2 id="UserList-对象"><a href="#UserList-对象" class="headerlink" title="UserList 对象"></a>UserList 对象</h2><p>这个类封装了列表对象。它是一个有用的基础类，对于你想自定义的类似列表的类，可以继承和覆盖现有的方法，也可以添加新的方法。这样我们可以对列表添加新的行为。</p>
<p>对这个类的需求已部分由直接创建 list 的子类的功能所替代；不过，这个类处理起来更容易，因为底层的列表可以作为属性来访问。</p>
<p>class collections.UserList([list])<br>模拟一个列表。这个实例的内容被保存为一个正常列表，通过 UserList 的 data 属性存取。实例内容被初始化为一个 list 的copy，默认为 [] 空列表。 list 可以是迭代对象，比如一个Python列表，或者一个 UserList 对象。</p>
<p>UserList 提供了以下属性作为可变序列的方法和操作的扩展:</p>
<p>data<br>一个 list 对象用于存储 UserList 的内容。</p>
<p>子类化的要求: UserList 的子类需要提供一个构造器，可以无参数调用，或者一个参数调用。返回一个新序列的列表操作需要创建一个实现类的实例。它假定了构造器可以以一个参数进行调用，这个参数是一个序列对象，作为数据源。</p>
<p>如果一个分离的类不希望依照这个需求，所有的特殊方法就必须重写；请参照源代码进行修改。</p>
<h2 id="UserString-对象"><a href="#UserString-对象" class="headerlink" title="UserString 对象"></a>UserString 对象</h2><p>UserString 类是用作字符串对象的外包装。对这个类的需求已部分由直接创建 str 的子类的功能所替代；不过，这个类处理起来更容易，因为底层的字符串可以作为属性来访问。</p>
<p>class collections.UserString(seq)<br>模拟一个字符串对象。这个实例对象的内容保存为一个正常字符串，通过 UserString 的 data 属性存取。实例内容初始化设置为 seq 的copy。seq 参数可以是任何可通过内建 str() 函数转换为字符串的对象。</p>
<p>UserString 提供了以下属性作为字符串方法和操作的额外支持：</p>
<p>data<br>一个真正的 str 对象用来存放 UserString 类的内容。</p>
<p>在 3.5 版更改: 新方法 <strong>getnewargs</strong>, <strong>rmod</strong>, casefold, format_map, isprintable, 和 maketrans。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://docs.python.org/zh-cn/3/library/collections.html#module-collections" target="_blank" rel="noopener">https://docs.python.org/zh-cn/3/library/collections.html#module-collections</a></p>

      
    </div>

    

    
      
    

    
    
    

    

    
      
    
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Mr Wang</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="https://forgetst.github.io/python/module/ckcq2n7st00gqawv7no5qht7v.html" title="python collections module">https://forgetst.github.io/python/module/ckcq2n7st00gqawv7no5qht7v.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      
    </div>

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a>
          
            <a href="/tags/module/" rel="tag"><i class="fa fa-tag"></i> module</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/python/module/ckcq2n7p000ebawv7p6x04sj2.html" rel="next" title="python pickle module">
                <i class="fa fa-chevron-left"></i> python pickle module
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/python/module/ckcq2n7oo00e4awv7j0h858ik.html" rel="prev" title="python argparse module">
                python argparse module <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
    <img class="site-author-image" itemprop="image" src="/images/profile.jpg" alt="Mr Wang">
  
  <p class="site-author-name" itemprop="name">Mr Wang</p>
  <div class="site-description motion-element" itemprop="description">行动了才会有故事，说出来才会有结果。</div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">119</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>



  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>





  <div class="links-of-author motion-element">
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/forgetST" title="GitHub &rarr; https://github.com/forgetST" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:yourname@gmail.com" title="E-Mail &rarr; mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://weibo.com/yourname" title="Weibo &rarr; https://weibo.com/yourname" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
    
  </div>







          
          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#方法概述"><span class="nav-number">1.</span> <span class="nav-text">方法概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ChainMap-对象"><span class="nav-number">2.</span> <span class="nav-text">ChainMap 对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-collections-ChainMap-maps"><span class="nav-number">2.1.</span> <span class="nav-text">class collections.ChainMap(*maps)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#maps"><span class="nav-number">2.1.1.</span> <span class="nav-text">maps</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#new-child-m-None"><span class="nav-number">2.1.2.</span> <span class="nav-text">new_child(m=None)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#parents"><span class="nav-number">2.1.3.</span> <span class="nav-text">parents</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ChainMap-例子和方法"><span class="nav-number">2.1.4.</span> <span class="nav-text">ChainMap 例子和方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Counter-对象"><span class="nav-number">3.</span> <span class="nav-text">Counter 对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-collections-Counter-iterable-or-mapping"><span class="nav-number">3.1.</span> <span class="nav-text">class collections.Counter([iterable-or-mapping])</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#elements"><span class="nav-number">3.1.1.</span> <span class="nav-text">elements()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#most-common-n"><span class="nav-number">3.1.2.</span> <span class="nav-text">most_common([n])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fromkeys-iterable"><span class="nav-number">3.1.3.</span> <span class="nav-text">fromkeys(iterable)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#update-iterable-or-mapping"><span class="nav-number">3.1.4.</span> <span class="nav-text">update([iterable-or-mapping])</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Counter对象的常用案例"><span class="nav-number">3.2.</span> <span class="nav-text">Counter对象的常用案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#deque-对象"><span class="nav-number">4.</span> <span class="nav-text">deque 对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-collections-deque-iterable-maxlen"><span class="nav-number">4.1.</span> <span class="nav-text">class collections.deque([iterable[, maxlen]])</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#append-x"><span class="nav-number">4.1.1.</span> <span class="nav-text">append(x)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#appendleft-x"><span class="nav-number">4.1.2.</span> <span class="nav-text">appendleft(x)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#clear"><span class="nav-number">4.1.3.</span> <span class="nav-text">clear()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#copy"><span class="nav-number">4.1.4.</span> <span class="nav-text">copy()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#count-x"><span class="nav-number">4.1.5.</span> <span class="nav-text">count(x)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#extend-iterable"><span class="nav-number">4.1.6.</span> <span class="nav-text">extend(iterable)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#extendleft-iterable"><span class="nav-number">4.1.7.</span> <span class="nav-text">extendleft(iterable)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#index-x-start-stop"><span class="nav-number">4.1.8.</span> <span class="nav-text">index(x[, start[, stop]])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#insert-i-x"><span class="nav-number">4.1.9.</span> <span class="nav-text">insert(i, x)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pop"><span class="nav-number">4.1.10.</span> <span class="nav-text">pop()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#popleft"><span class="nav-number">4.1.11.</span> <span class="nav-text">popleft()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#remove-value"><span class="nav-number">4.1.12.</span> <span class="nav-text">remove(value)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reverse"><span class="nav-number">4.1.13.</span> <span class="nav-text">reverse()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rotate-n-1"><span class="nav-number">4.1.14.</span> <span class="nav-text">rotate(n=1)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#maxlen"><span class="nav-number">4.1.15.</span> <span class="nav-text">maxlen</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deque-用法"><span class="nav-number">4.2.</span> <span class="nav-text">deque 用法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#defaultdict-对象"><span class="nav-number">5.</span> <span class="nav-text">defaultdict 对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-collections-defaultdict-default-factory-…"><span class="nav-number">5.1.</span> <span class="nav-text">class collections.defaultdict([default_factory[, …]])</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#missing-key"><span class="nav-number">5.1.1.</span> <span class="nav-text">missing(key)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#default-factory"><span class="nav-number">5.1.2.</span> <span class="nav-text">default_factory</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#defaultdict-例子"><span class="nav-number">5.2.</span> <span class="nav-text">defaultdict 例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#namedtuple-命名元组的工厂函数"><span class="nav-number">6.</span> <span class="nav-text">namedtuple() 命名元组的工厂函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#collections-namedtuple-typename-field-names-rename-False-defaults-None-module-None"><span class="nav-number">6.1.</span> <span class="nav-text">collections.namedtuple(typename, field_names, *, rename=False, defaults=None, module=None)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#classmethod-somenamedtuple-make-iterable"><span class="nav-number">6.1.1.</span> <span class="nav-text">classmethod somenamedtuple._make(iterable)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#somenamedtuple-asdict"><span class="nav-number">6.1.2.</span> <span class="nav-text">somenamedtuple._asdict()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#somenamedtuple-replace-kwargs"><span class="nav-number">6.1.3.</span> <span class="nav-text">somenamedtuple._replace(**kwargs)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#somenamedtuple-fields"><span class="nav-number">6.1.4.</span> <span class="nav-text">somenamedtuple._fields</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#somenamedtuple-field-defaults"><span class="nav-number">6.1.5.</span> <span class="nav-text">somenamedtuple._field_defaults</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OrderedDict-对象"><span class="nav-number">7.</span> <span class="nav-text">OrderedDict 对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-collections-OrderedDict-items"><span class="nav-number">7.1.</span> <span class="nav-text">class collections.OrderedDict([items])</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#popitem-last-True"><span class="nav-number">7.1.1.</span> <span class="nav-text">popitem(last=True)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#move-to-end-key-last-True"><span class="nav-number">7.1.2.</span> <span class="nav-text">move_to_end(key, last=True)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OrderedDict-例子和用法"><span class="nav-number">7.2.</span> <span class="nav-text">OrderedDict 例子和用法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UserDict-对象"><span class="nav-number">8.</span> <span class="nav-text">UserDict 对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UserList-对象"><span class="nav-number">9.</span> <span class="nav-text">UserList 对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UserString-对象"><span class="nav-number">10.</span> <span class="nav-text">UserString 对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">11.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
      
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>
</div>


        
      </main></div>
    

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr Wang</span>

  

  
</div>










  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  <span class="post-meta-divider">|</span>
  <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>



        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    
  

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  
  













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>




  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  


  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/01/assets/haru01.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>



<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>

</html>


